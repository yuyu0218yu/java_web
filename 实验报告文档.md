# 实验报告
第28组+张家界后台管理系统

## 基本信息
- 组别+项目名：第28组+张家界后台管理系统
- 课程名称：
- 实验名称：
- 姓名：
- 学号：
- 班级：
- 指导教师：
- 实验日期：

## 一、实验目的
1. 熟悉基于 Spring Boot 3 的多模块后端项目结构与分层设计。
2. 掌握 JWT + Spring Security 的认证与权限控制。
3. 掌握 MyBatis-Plus 在 CRUD、分页、逻辑删除中的使用。
4. 理解操作日志、登录日志、数据权限等横切功能的实现方式。
5. 完成前后端分离后台管理系统的核心功能搭建。

## 二、实验内容
- 构建“张家界后台管理系统”后端与前端基础框架。
- 实现用户、角色、菜单、部门、字典、通知、定时任务、日志、文件管理等功能模块。
- 提供统一的 REST API、权限控制、日志审计、文件上传下载和仪表盘统计接口。
- 集成代码生成器模块用于快速生成业务代码。

## 三、实验环境
### 3.1 后端
- Java: 17
- Maven: 依赖管理与构建
- Spring Boot: 3.3.6
- MyBatis-Plus: 3.5.14
- Spring Security + JWT (jjwt 0.12.3)
- EasyExcel: 3.3.4
- Freemarker: 2.3.32
- Springdoc OpenAPI: 2.3.0
- 数据库: MySQL (基于 `com.mysql.cj.jdbc.Driver`)

### 3.2 前端
- Vue 3 (Composition API)
- Element Plus
- Vue Router 4
- Pinia
- Axios
- Vite
- Node.js >= 16.0.0, npm >= 7.0.0

## 四、系统总体设计
### 4.1 模块划分
- `zhangjiajie-admin`: 启动入口与运行配置。
- `zhangjiajie-system`: 核心业务模块（控制器、服务、Mapper、实体、DTO、权限与日志）。
- `zhangjiajie-common`: 通用工具、统一返回、异常、枚举与公共配置。
- `zhangjiajie-generator`: 代码生成器模块。
- `frontend`: Vue 3 前端项目。

### 4.2 分层架构
- Controller：接口层，定义 REST API。
- Service：业务逻辑层。
- Mapper：数据库访问层（MyBatis-Plus）。
- Entity/DTO：数据模型与请求/响应对象。
- Config/Security/Aspect：安全配置、AOP 日志、数据权限等横切功能。

## 五、关键功能与实现要点
### 5.1 认证与授权
- `SecurityConfig` 配置无状态会话、CORS、JWT 过滤链。
- `JwtAuthenticationFilter` 解析请求头 `Authorization: Bearer <token>` 并完成认证。
- `UserDetailsServiceImpl` 加载用户角色与权限，支持 `ROLE_` 与权限字符串。

### 5.2 权限与菜单
- 角色管理：`/api/roles`。
- 菜单管理：`/api/menus`，提供菜单树与用户权限列表。
- 用户管理：`/api/users`，支持分页查询、增删改、导入导出。

### 5.3 日志与审计
- `AuditLogAspect` 对标注 `@AuditLog` 的接口进行操作日志记录。
- `LoginEventListener` 异步记录登录日志。

### 5.4 数据权限
- `DataScopeAspect` 依据用户数据范围生成 SQL 过滤条件，支持“全部/本部门/本部门及子部门/仅本人”。

### 5.5 文件管理
- `FileController` 支持单/批量上传、下载、预览、统计、热门/最新文件。
- `FileUploadConfig` 提供静态资源映射与上传目录管理。

### 5.6 定时任务
- `JobController` 支持任务创建、暂停/恢复、立即执行、Cron 校验。
- `JobLogController` 管理任务日志。

### 5.7 代码生成器
- `GeneratorConfig` 配置生成路径、作者、是否覆盖、DTO/Converter/测试生成等选项。
- `MyBatisPlusCodeGenerator` 等组件支持快速生成 CRUD 模板。

## 六、数据库设计（依据实体类推断）
主要实体与关联关系：
- 用户与角色：`User`、`Role`、`UserRole`
- 角色与菜单：`RoleMenu`、`Menu`
- 部门组织：`Dept`
- 字典：`DictType`、`DictData`
- 日志：`LoginLog`、`OperationLog`、`JobLog`
- 定时任务：`Job`
- 通知公告：`Notice`
- 文件：`FileInfo`

说明：具体字段与建表脚本需以实际数据库脚本为准。

## 七、主要接口设计（节选）
| 模块 | 方法 | 路径 | 说明 |
| --- | --- | --- | --- |
| 认证 | POST | `/api/auth/login` | 登录获取 Token |
| 认证 | POST | `/api/auth/register` | 注册用户 |
| 用户 | GET | `/api/users/page` | 用户分页查询 |
| 角色 | GET | `/api/roles` | 角色列表 |
| 菜单 | GET | `/api/menus/user` | 当前用户菜单树 |
| 部门 | GET | `/api/depts/tree` | 部门树 |
| 字典 | GET | `/api/dict/types/page` | 字典类型分页 |
| 字典 | GET | `/api/dict/data/page` | 字典数据分页 |
| 文件 | POST | `/api/files/upload` | 文件上传 |
| 日志 | GET | `/api/logs/login/page` | 登录日志分页 |
| 日志 | GET | `/api/logs/operation/page` | 操作日志分页 |
| 任务 | GET | `/api/jobs/page` | 定时任务分页 |
| 仪表盘 | GET | `/api/dashboard/statistics` | 统计数据 |

## 八、关键配置说明
- 数据库连接：`spring.datasource.*`（`application.yml`）
- JWT 配置：`jwt.secret`、`jwt.expiration`、`jwt.refresh-expiration`
- 文件上传：`file.upload.path`、`file.upload.max-size`、`file.upload.allowed-types`
- 服务端口：`server.port`（默认 8080）
- 前端代理：`frontend/vite.config.js` 中 `/api -> http://localhost:8080`

## 九、运行步骤（参考）
1. 创建数据库 `java_web`，并导入对应表结构与初始数据。
2. 修改 `zhangjiajie-admin/src/main/resources/application.yml` 的数据库账号密码。
3. 启动后端：运行 `ZhangjiajieAdminApplication` 或执行 Maven 启动。
4. 启动前端：在 `frontend` 中执行 `npm install`、`npm run dev`。
5. 访问前端页面并使用账号登录验证功能。

## 十一、问题与改进（可选）
- 登录失败原因追踪与异常分类优化。
- 文件存储可扩展为对象存储（如 MinIO）。
- 细化权限粒度与菜单按钮级别控制。
- 增加数据库迁移脚本管理（如 Flyway/Liquibase）。

## 十二、实验小结（待补充）
- 本次实验掌握了后端模块化结构、JWT 权限控制、常见管理系统模块的实现方式。
